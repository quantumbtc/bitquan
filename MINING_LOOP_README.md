# 比特币循环挖矿功能

## 概述

我们已经成功修改了 `bitcoin-cli` 的 `-generate` 命令，现在支持可持续挖矿功能。这个功能允许你持续生成区块，直到手动停止。

## 新功能特性

### 1. 循环挖矿语法
```bash
# 基本语法
bitcoin-cli -generate loop [nblocks] [maxtries]

# 示例
bitcoin-cli -generate loop 1 1000    # 每次生成1个区块，最大尝试1000次
bitcoin-cli -generate loop 2 500     # 每次生成2个区块，最大尝试500次
bitcoin-cli -generate loop           # 使用默认值：每次生成1个区块
```

### 2. 参数说明
- `loop`: 启用循环挖矿模式
- `nblocks`: 每次迭代生成的区块数量（可选，默认为1）
- `maxtries`: 每个区块的最大尝试次数（可选，默认为1000000）

### 3. 使用方法

#### Linux/Mac
```bash
# 开始循环挖矿
bitcoin-cli -generate loop 1 1000

# 或者使用测试脚本
chmod +x test_mining_loop.sh
./test_mining_loop.sh
```

#### Windows
```cmd
# 开始循环挖矿
bitcoin-cli -generate loop 1 1000

# 或者使用批处理文件
test_mining_loop.bat
```

## 功能特点

### 1. 自动循环
- 挖矿过程会自动循环进行
- 每次成功生成区块后会立即开始下一次挖矿
- 无需手动重复执行命令

### 2. 实时反馈
- 显示每次迭代的进度
- 显示生成的区块数量
- 显示挖矿地址信息

### 3. 错误处理
- 自动处理挖矿过程中的错误
- 在出错时停止循环并显示错误信息
- 支持优雅退出（Ctrl+C）

### 4. 性能优化
- 在每次迭代之间添加小延迟，防止系统过载
- 使用现有的 RPC 接口，保持兼容性

## 使用场景

### 1. 开发测试
- 快速生成测试区块
- 验证区块链功能
- 测试挖矿奖励机制

### 2. 私有网络
- 维护私有区块链
- 持续生成新区块
- 保持网络活跃

### 3. 教学演示
- 演示挖矿过程
- 展示区块链增长
- 教学区块链概念

## 注意事项

### 1. 系统要求
- 确保比特币节点正在运行
- 确保钱包已解锁
- 确保有足够的计算资源

### 2. 安全考虑
- 循环挖矿会持续消耗系统资源
- 建议在测试环境中使用
- 生产环境请谨慎使用

### 3. 停止方法
- 按 `Ctrl+C` 停止挖矿
- 挖矿会在当前区块完成后停止
- 不会中断正在进行的挖矿过程

## 技术实现

### 1. 修改的文件
- `src/bitcoin-cli.cpp`: 主要修改文件
- 添加了循环挖矿逻辑
- 修改了参数处理函数

### 2. 新增功能
- 循环挖矿检测
- 自动参数调整
- 持续挖矿循环

### 3. 兼容性
- 保持原有 `-generate` 功能不变
- 向后兼容现有脚本
- 不影响其他 CLI 功能

## 故障排除

### 1. 常见问题
- **连接失败**: 检查比特币节点是否运行
- **权限错误**: 确保钱包已解锁
- **参数错误**: 检查命令语法

### 2. 调试方法
- 使用 `bitcoin-cli getblockchaininfo` 检查节点状态
- 使用 `bitcoin-cli getwalletinfo` 检查钱包状态
- 查看控制台输出获取错误信息

## 更新日志

### v1.0.0
- 添加循环挖矿功能
- 支持自定义区块数量和尝试次数
- 添加错误处理和用户反馈
- 创建测试脚本和文档

## 贡献

如果你发现任何问题或有改进建议，请：
1. 检查现有问题报告
2. 创建新的问题报告
3. 提交代码改进

## 许可证

本项目遵循 MIT 许可证。详见 LICENSE 文件。
